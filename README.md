# Artix-7-FFT
Nicholas Palladino U52182660
Issam Haddad U64708933
Peter Crary U61020993
Anthony Saab U90831072

# Project Demo Video
https://drive.google.com/drive/folders/1ZjeA_Lr92YTrXM2x_BXecFyNE9qc24BQ?usp=sharing

# Overview
This project collects samples from an SPI microphone with analog to digital converter, downsamples them to achieve a sample rate within the audio spectrum, and performs a discrete Fourier transform. The output bins are then displayed as a bar plot over the VGA interface.

# Running Our Project
Sound can be played into the PMOD microphone with gain adjusted for best performance. Switches are included to adjust the number of bins displayed and the scaling of the bars. Depending on the application, different settings may be ideal.


# Code Overview

## adc.v 
This module handles the SPI interface to Digilent’s PMOD MIC3 microphone with ADC. It is provided with a 16MHz clock that is passed on to the PMOD board, with each sample needing 16 cycles. Following a high chip select (adc_cs) output, the first 4 cycles consist of leading zeros. The remaining 12 make up the 12-bit sample value. This results in a sample throughput of 1 MSPS, available at the module's “data” output when “ready” is high, which indicates the sample is complete.

## bram_to_fft.v
This serves as a buffer between the decimator and the FFT core. The samples are loaded from the ADC and then passed along as a collection of points corresponding to the number of bins. Some error checking is done to validate the data stream.

## decimator.v
This module takes 12 bits input “data_in”  from the ADC’s output. Everytime the ADC outputs data, chip enable “ce” goes high and increments the register “count” by 1. When count is equal to 32, the decimator outputs data to the next module. So the decimator outputs each 32nd data input it gets. The output “new_sample”  plays the role of the chip enable for the FFT module.

## plotter.v
The takes the output data from the FFT for each applicable bin and generates a corresponding address and pixel indicator. This is then used 

## synchronizer.v
The synchronizer is used to align the 60Hz vertical refresh and 104MHz main clocks. When pulsed this can be used to start the FFT.

## level2pulse.v
This module generates a pulse for a singular 104MHz cycle synchronized with the 60Hz vertical sync.

## xvga.v
This generates the timing tools and clocks used for the VGA output. It uses a 104MHz input clock to generate the vertical and horizontal syncs, as well as a blanking period output. The “hcount” and “vcount” registers hold the current pixel’s position starting from the top left.


# Matlab Verification
We included a Matlab function that gets the sound input from the computer’s microphone and generates the FFT of this signal. The FFT generated by the Matlab code can be used as a comparison to the FFT from the FPGA displayed on the VGA. It demonstrates the functionality of our Verilog model.
Only difference with the Verilog module is that the harmonics are not displayed on the MATLAB plots because of the properties of the FFT function in MATLAB



# Graveyard

The graveyard contains unfinished and unused projects that didn’t make their way into our final design.

## digital-synth-fft
This unfinished project is both a digital synthesizer and FFT implementation.  The input to the FFT is a signal generated by the addition of up to four digitally synthesized sine waves.  The frequency of each sine wave can be set using a PS2 keyboard interface.  The sine waves to be added can be selected using switches.  The additive signal is the input to the FFT, which produces an output that is stored in external memory.  Due to internal memory limitations, the FFT output is stored in SDRAM, and controlled using an SRAM to DDR component.  The memory is accessed by a VGA controller, which creates two visual representations of the data: a spectrogram and a histogram.

## fft-pwm
Implements an FFT on an FPGA using an external PMOD microphone as an input, and displays the output of the FFT on pulse-width modulated LEDs.  Each LED contains a bin of frequencies, and the LED brightness provides the amplitude.

## arduino
Two Arduino sketches—an ADC that outputs parallel data via digital pins for use with an FPGA FFT implementation, and parallel digital plotter for the output of an FPGA-implemented FFT.  These sketches were used for debugging before VGA was introduced to our design.

# Relevant Images
https://i.imgur.com/1yixTF7.png
https://imgur.com/a/uZz0A59
